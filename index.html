<!doctype html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no" />
<title>Galactic Trial</title>
<style>
*{box-sizing:border-box}html,body{margin:0;width:100%;height:100%;overflow:hidden;touch-action:none;background:#060b12;color:#f0f6ff;font-family:Trebuchet MS,Segoe UI,sans-serif}
#game{position:fixed;inset:0;width:100vw;height:100vh;display:block}
#hud{position:fixed;top:max(10px,env(safe-area-inset-top));left:max(10px,env(safe-area-inset-left));right:max(10px,env(safe-area-inset-right));z-index:8;display:flex;justify-content:space-between;align-items:center;padding:10px 14px;border-radius:14px;background:linear-gradient(135deg,rgba(6,12,20,.72),rgba(16,29,45,.56));border:1px solid rgba(180,220,255,.22)}
#title{font-weight:900;letter-spacing:.08em}#stats{font-weight:700;display:flex;gap:12px}
#cheat{position:fixed;top:max(58px,calc(16px + env(safe-area-inset-top)));left:50%;transform:translateX(-50%);z-index:9;padding:8px 14px;border-radius:10px;border:1px solid rgba(255,220,120,.65);background:rgba(75,45,10,.72);font-weight:900;display:none}
#msg{position:fixed;top:max(98px,calc(60px + env(safe-area-inset-top)));left:50%;transform:translateX(-50%);z-index:9;padding:8px 14px;border-radius:10px;border:1px solid rgba(160,220,255,.65);background:rgba(12,34,56,.78);font-weight:900;opacity:0;transition:opacity .2s}
#msg.show{opacity:1}
#controls{position:fixed;z-index:10;left:max(10px,env(safe-area-inset-left));right:max(10px,env(safe-area-inset-right));bottom:max(10px,env(safe-area-inset-bottom));display:flex;justify-content:space-between;pointer-events:none}
.pad{display:flex;gap:10px;pointer-events:auto}.b{width:78px;height:78px;border-radius:18px;border:1px solid rgba(210,230,255,.44);background:linear-gradient(165deg,rgba(16,27,41,.9),rgba(10,18,28,.82));color:#fff;font-weight:900;font-size:22px}.b:active,.b.on{transform:translateY(2px) scale(.98)}
#rotate{position:fixed;inset:0;display:none;z-index:20;place-items:center;text-align:center;padding:24px;background:rgba(2,6,10,.95);font-size:6vw;font-weight:900}
#win{position:fixed;inset:0;display:none;z-index:15;place-items:center;background:rgba(0,0,0,.74)}#win>div{background:linear-gradient(145deg,#101b2a,#0a1320);padding:24px;border:1px solid rgba(190,220,255,.35);border-radius:16px;text-align:center}
@media (orientation:portrait){#rotate{display:grid}#game,#hud,#controls,#cheat,#msg{filter:blur(2px) brightness(.7)}}
</style>
</head>
<body>
<div id="rotate">Переверни телефон в горизонтальный режим</div>
<div id="hud"><span id="title">GALACTIC TRIAL</span><span id="stats"><span id="level">Уровень 1/10</span><span id="deaths">Смерти: 0</span><span id="time">Время: 0.0с</span></span></div>
<div id="cheat">ВЫ ПОД ЧИТКОДОМ</div>
<div id="msg"></div>
<canvas id="game"></canvas>
<div id="controls"><div class="pad"><button id="l" class="b">◀</button><button id="r" class="b">▶</button></div><div class="pad"><button id="j" class="b">J</button><button id="d" class="b">D</button></div></div>
<div id="win"><div><h2>Все 10 уровней пройдены</h2><p id="res"></p><button id="retry" class="b" style="width:190px;height:56px;font-size:16px">Еще раз</button></div></div>
<script>
const LEVELS=10,H=1300;
const themes=[
['#070b1a','#10243f','#1c3659','59,94,149','#89b4ff','Орбита Титана'],
['#16070d','#3a1020','#5d1e35','155,59,98','#ff9eb1','Багровая туманность'],
['#07141f','#113a4e','#1a5670','92,166,198','#d4f4ff','Ледяной космос'],
['#140f09','#3e2a15','#6b4722','182,124,58','#ffd58f','Песчаная система'],
['#05140f','#0d3d2b','#186847','56,161,115','#b9ffd8','Изумрудная даль'],
['#12081f','#2d0f4f','#4c1a78','125,76,196','#dbc1ff','Фиолетовый шторм'],
['#040f20','#0b2f63','#134c9b','61,123,223','#a7d0ff','Голубой гигант'],
['#111214','#282c33','#3d4450','94,104,120','#c7ceda','Пепельный пояс'],
['#090013','#2a0442','#4f0b77','188,56,255','#ffb7ff','Неоновая сингулярность'],
['#150a00','#4b1f00','#7a3000','228,106,35','#ffd29a','Корона звезды']
];
const cv=document.getElementById('game'),cx=cv.getContext('2d',{alpha:false});
const levelEl=document.getElementById('level'),deathsEl=document.getElementById('deaths'),timeEl=document.getElementById('time'),msgEl=document.getElementById('msg');
const win=document.getElementById('win'),res=document.getElementById('res'),cheatEl=document.getElementById('cheat');
const p={x:120,y:920,w:34,h:44,vx:0,vy:0,f:1,g:false,c:0,jb:0,dc:0,ds:0,dd:1};
const ph={spd:360,acc:3000,fr:3400,gr:2100,j:810,mf:1250,ct:.09,jbt:.12,dh:840,dd:.16,cd:.72};
let keys=new Set(),inp={l:false,r:false,j:false,d:false},cam={x:0,y:0};
let cur=null,level=0,deaths=0,start=performance.now(),done=false,cheat=false,cheatHold=0,lastTaunt=0,msgTo=0;
const cl=(v,a,b)=>Math.max(a,Math.min(b,v)),hit=(a,b)=>a.x<b.x+b.w&&a.x+a.w>b.x&&a.y<b.y+b.h&&a.y+a.h>b.y;
const chr=(x,y,r,o)=>{const nx=cl(x,o.x,o.x+o.w),ny=cl(y,o.y,o.y+o.h),dx=x-nx,dy=y-ny;return dx*dx+dy*dy<=r*r};
function rr(x,y,w,h,r){cx.beginPath();cx.moveTo(x+r,y);cx.arcTo(x+w,y,x+w,y+h,r);cx.arcTo(x+w,y+h,x,y+h,r);cx.arcTo(x,y+h,x,y,r);cx.arcTo(x,y,x+w,y,r);cx.closePath()}
const rng=s=>()=>((s=(s*1664525+1013904223)>>>0)/4294967296);
let dpr=1,bg=document.createElement('canvas');
function showMsg(t,ms=1800){msgEl.textContent=t;msgEl.classList.add('show');clearTimeout(msgTo);msgTo=setTimeout(()=>msgEl.classList.remove('show'),ms)}
function buildSky(){const w=innerWidth,h=innerHeight;bg.width=Math.floor(w*dpr);bg.height=Math.floor(h*dpr);const s=bg.getContext('2d');s.setTransform(dpr,0,0,dpr,0,0);const th=themes[level];const g=s.createLinearGradient(0,0,0,h);g.addColorStop(0,th[0]);g.addColorStop(.55,th[1]);g.addColorStop(1,th[2]);s.fillStyle=g;s.fillRect(0,0,w,h);for(let i=0;i<3;i++){s.fillStyle='rgba('+th[3]+','+(0.08+i*0.03)+')';s.beginPath();s.ellipse((i*430+80)%w,180+i*90,220,70,0,0,Math.PI*2);s.fill()}s.fillStyle=th[4];s.globalAlpha=.24;s.beginPath();s.arc(w-220,170,95,0,Math.PI*2);s.fill();s.globalAlpha=1}
function resize(){dpr=Math.min(devicePixelRatio||1,1.25);cv.width=Math.floor(innerWidth*dpr);cv.height=Math.floor(innerHeight*dpr);cx.setTransform(dpr,0,0,dpr,0,0);if(cur)buildSky()}
function levelGen(i){const r=rng(5000+i*311),width=3400+i*380,start={x:120,y:920},goal={x:width-150,y:150,w:64,h:100};
const plats=[{x:0,y:1060,w:520,h:220,type:'solid'}];let x=620;
for(let n=0;n<11+i;n++){x+=170+Math.floor(r()*120);let y=900-n*32+Math.sin(n*0.8+i)*120;y=cl(y,320,980);const w=110+Math.floor(r()*90),t=((n+i)%4===0)?'crumble':'solid';plats.push({x,y,w,h:22,type:t,timer:0,gone:false,restore:0})}
plats.push({x:width-360,y:250,w:320,h:24,type:'solid'});
const spikes=[];for(let g=0;g<5+i;g++){const sx=500+Math.floor(g*(width-900)/(5+i));spikes.push({x:sx,y:1042,w:90+Math.floor(r()*140),h:18})}
for(const pl of plats){if(pl.y<900&&pl.type==='solid'&&r()<0.33)spikes.push({x:pl.x+10,y:pl.y-18,w:Math.max(60,pl.w-20),h:18})}
const saws=[];for(let s=0;s<3+Math.floor(i/2);s++)saws.push({cx:850+Math.floor(r()*(width-1300)),cy:360+Math.floor(r()*560),r:20+Math.floor(r()*10),a:r()<0.5?'x':'y',amp:110+Math.floor(r()*160),sp:2+r()*1.8,ph:r()*6.28});
const lasers=[];for(let l=0;l<2+Math.floor(i/3);l++)lasers.push({x:950+Math.floor(r()*(width-1500)),y:180+Math.floor(r()*240),w:16,h:830-Math.floor(r()*150),per:1.2+r()*0.8,on:0.55+r()*0.45,ph:r()*1.1});
const stars=[];for(let k=0;k<56;k++)stars.push({x:r(),y:r(),a:0.2+r()*0.65,s:1+r()*1.5});
return{width,height:H,start,goal,plats,spikes,saws,lasers,stars}}
function loadLevel(i){cur=levelGen(i);p.x=cur.start.x;p.y=cur.start.y;p.vx=0;p.vy=0;buildSky();levelEl.textContent='Уровень '+(i+1)+'/10';showMsg('УРОВЕНЬ '+(i+1)+': '+themes[i][5],2000)}
function resetAll(){deaths=0;start=performance.now();done=false;cheat=false;cheatHold=0;cheatEl.style.display='none';level=0;loadLevel(0);win.style.display='none'}
function die(){if(done)return;sfx('death');taunt();deaths++;p.x=cur.start.x;p.y=cur.start.y;p.vx=0;p.vy=0}
function bind(id,d,u){const b=document.getElementById(id);const on=e=>{e.preventDefault();audioOn();b.classList.add('on');d()};const off=e=>{e.preventDefault();b.classList.remove('on');u()};b.addEventListener('touchstart',on,{passive:false});b.addEventListener('mousedown',on);['touchend','touchcancel','mouseup','mouseleave'].forEach(ev=>b.addEventListener(ev,off))}
bind('l',()=>inp.l=true,()=>inp.l=false);bind('r',()=>inp.r=true,()=>inp.r=false);bind('j',()=>inp.j=true,()=>{});bind('d',()=>inp.d=true,()=>{});
addEventListener('keydown',e=>{audioOn();keys.add(e.code);if(['ArrowUp','Space','KeyW'].includes(e.code))inp.j=true;if(['ShiftLeft','ShiftRight','KeyK'].includes(e.code))inp.d=true});
addEventListener('keyup',e=>keys.delete(e.code));addEventListener('resize',resize);document.getElementById('retry').onclick=resetAll;
let actx=null,aReady=false;function audioOn(){if(!actx){const C=window.AudioContext||window.webkitAudioContext;if(!C)return;actx=new C()}if(actx.state==='suspended')actx.resume();aReady=true}
function sfx(t){if(!actx||!aReady)return;const n=actx.currentTime,o=actx.createOscillator(),g=actx.createGain();o.connect(g);g.connect(actx.destination);if(t==='jump'){o.type='triangle';o.frequency.setValueAtTime(280,n);o.frequency.exponentialRampToValueAtTime(520,n+.09);g.gain.setValueAtTime(.0001,n);g.gain.exponentialRampToValueAtTime(.05,n+.01);g.gain.exponentialRampToValueAtTime(.0001,n+.11);o.start(n);o.stop(n+.12);return}if(t==='dash'){o.type='sawtooth';o.frequency.setValueAtTime(145,n);o.frequency.exponentialRampToValueAtTime(92,n+.12);g.gain.setValueAtTime(.0001,n);g.gain.exponentialRampToValueAtTime(.07,n+.01);g.gain.exponentialRampToValueAtTime(.0001,n+.14);o.start(n);o.stop(n+.15);return}if(t==='death'){o.type='square';o.frequency.setValueAtTime(180,n);o.frequency.exponentialRampToValueAtTime(58,n+.3);g.gain.setValueAtTime(.0001,n);g.gain.exponentialRampToValueAtTime(.07,n+.01);g.gain.exponentialRampToValueAtTime(.0001,n+.32);o.start(n);o.stop(n+.33);return}o.type='triangle';o.frequency.setValueAtTime(330,n);o.frequency.exponentialRampToValueAtTime(660,n+.22);g.gain.setValueAtTime(.0001,n);g.gain.exponentialRampToValueAtTime(.06,n+.02);g.gain.exponentialRampToValueAtTime(.0001,n+.28);o.start(n);o.stop(n+.29)}
function taunt(){if(!('speechSynthesis'in window))return;const now=performance.now();if(now-lastTaunt<1800)return;lastTaunt=now;const u=new SpeechSynthesisUtterance('ТЫ НЕ ПРОЙДЕШ ахахахахах!');u.lang='ru-RU';u.rate=.92;u.pitch=.65;speechSynthesis.cancel();speechSynthesis.speak(u)}
function solids(){return cur.plats.filter(t=>t.type!=='crumble'||!t.gone)}
function update(dt,et){for(const t of cur.plats)if(t.type==='crumble'&&t.gone){t.restore-=dt;if(t.restore<=0){t.gone=false;t.timer=0}}
const left=inp.l||keys.has('ArrowLeft')||keys.has('KeyA'),right=inp.r||keys.has('ArrowRight')||keys.has('KeyD');
if(!cheat&&left&&right){cheatHold+=dt;if(cheatHold>=5){cheat=true;cheatEl.style.display='block';showMsg('ЧИТКОД АКТИВЕН',1600)}}else if(!cheat)cheatHold=0;
const m=(right?1:0)-(left?1:0);if(m)p.f=m;if(inp.j)p.jb=ph.jbt;if(inp.d&&p.dc<=0&&!p.ds){sfx('dash');p.ds=ph.dd;p.dd=m||p.f||1;p.vx=p.dd*ph.dh;p.vy=0;p.dc=ph.cd}inp.j=false;inp.d=false;p.jb-=dt;p.c-=dt;p.dc-=dt;
if(p.ds>0){p.ds-=dt;p.vx=p.dd*ph.dh;p.vy=0}else{const tgt=m*ph.spd;if(m){const dir=Math.sign(tgt-p.vx);p.vx+=dir*ph.acc*dt;if((dir>0&&p.vx>tgt)||(dir<0&&p.vx<tgt))p.vx=tgt}else{const f=Math.sign(p.vx),a=ph.fr*dt;p.vx=Math.abs(p.vx)<=a?0:p.vx-f*a}p.vy=Math.min(p.vy+ph.gr*dt,ph.mf)}
if(p.jb>0&&(p.g||p.c>0)){sfx('jump');p.vy=-ph.j;p.g=false;p.c=0;p.jb=0}
const s=solids();p.x+=p.vx*dt;for(const t of s){if(!hit(p,t))continue;if(p.vx>0)p.x=t.x-p.w;else if(p.vx<0)p.x=t.x+t.w;p.vx=0}
p.y+=p.vy*dt;p.g=false;for(const t of s){if(!hit(p,t))continue;if(p.vy>0){p.y=t.y-p.h;p.vy=0;p.g=true;p.c=ph.ct;if(t.type==='crumble'){t.timer+=dt;if(t.timer>.28){t.gone=true;t.restore=2.4}}}else if(p.vy<0){p.y=t.y+t.h;p.vy=0}}
if(!p.g)for(const t of cur.plats)if(t.type==='crumble')t.timer=0;p.x=cl(p.x,0,cur.width-p.w);
if(!cheat){for(const t of cur.spikes)if(hit(p,t))return die();for(const sw of cur.saws){const tt=et*sw.sp+sw.ph,x=sw.cx+(sw.a==='x'?Math.sin(tt)*sw.amp:0),y=sw.cy+(sw.a==='y'?Math.sin(tt)*sw.amp:0);if(chr(x,y,sw.r,p))return die()}for(const l of cur.lasers){if(((et+l.ph)%l.per)<l.on&&hit(p,l))return die()}}
if(p.y>cur.height+120)return die();if(hit(p,cur.goal)){if(level<LEVELS-1){level++;loadLevel(level);p.x=cur.start.x;p.y=cur.start.y}else{done=true;sfx('win');win.style.display='grid';res.textContent='Смерти: '+deaths+' | Время: '+((performance.now()-start)/1000).toFixed(2)+'с'}}}
function hero(et){const bw=54,bh=82,bx=p.x+(p.w-bw)*.5,by=p.y+p.h-bh+3,mv=Math.abs(p.vx)>45,s=(mv?1:.2)*Math.sin(et*14+Math.abs(p.vx)*.01)*.45,tr=p.ds>0?3:mv?1:0;cx.save();if(p.f<0){cx.translate(bx+bw*.5,0);cx.scale(-1,1);cx.translate(-(bx+bw*.5),0)}for(let i=tr;i>=1;i--){cx.globalAlpha=.09+i*.05;body(bx-i*5,by+i*.7,s*.5)}cx.globalAlpha=1;body(bx,by,s);if(mv||p.ds>0){const len=p.ds>0?50:30,pulse=.4+Math.abs(Math.sin(et*19))*.45;cx.fillStyle='rgba(255,68,68,'+pulse+')';cx.fillRect(bx+bw-4,by+34,len,4);cx.fillStyle='rgba(255,194,194,'+(pulse*.8)+')';cx.fillRect(bx+bw-4,by+35,len,2)}cx.restore()}
function body(x,y,s){const cape=cx.createLinearGradient(x,y+8,x+54,y+82);cape.addColorStop(0,'#131720');cape.addColorStop(1,'#2a3140');cx.fillStyle=cape;cx.beginPath();cx.moveTo(x+8,y+26);cx.lineTo(x-4,y+78);cx.lineTo(x+22,y+70);cx.lineTo(x+50,y+82);cx.lineTo(x+42,y+30);cx.closePath();cx.fill();cx.save();cx.translate(x+20,y+52);cx.rotate(s);cx.fillStyle='#141b26';rr(-8,0,16,28,6);cx.fill();cx.restore();cx.save();cx.translate(x+34,y+52);cx.rotate(-s);cx.fillStyle='#141b26';rr(-8,0,16,28,6);cx.fill();cx.restore();cx.fillStyle='#1e2633';rr(x+12,y+24,30,28,8);cx.fill();cx.fillStyle='#0f141e';rr(x+18,y+28,18,12,3);cx.fill();cx.fillStyle='#7ff6c0';cx.fillRect(x+19,y+29,3,3);cx.fillStyle='#74d7ff';cx.fillRect(x+24,y+29,3,3);cx.fillStyle='#ff7171';cx.fillRect(x+29,y+29,3,3);cx.fillStyle='#111723';cx.beginPath();cx.ellipse(x+27,y+14,12,14,0,0,Math.PI*2);cx.fill();cx.fillStyle='#293444';cx.beginPath();cx.ellipse(x+27,y+12,8,8,0,0,Math.PI*2);cx.fill();cx.fillStyle='#d5e1f5';cx.fillRect(x+22,y+15,3,2);cx.fillRect(x+29,y+15,3,2)}
function draw(et){const w=innerWidth,h=innerHeight;cx.drawImage(bg,0,0,w,h);for(const st of cur.stars){const x=(st.x*w-et*(6+st.s*4))%w;cx.fillStyle='rgba(220,235,255,'+st.a+')';cx.fillRect((x+w)%w,st.y*h,2,2)}cx.save();cx.translate(-cam.x,-cam.y);
cx.fillStyle='#8fd2ff';cx.fillRect(cur.start.x-12,cur.start.y-100,12,100);cx.fillStyle='#dff5ff';cx.fillRect(cur.start.x,cur.start.y-92,42,24);cx.fillStyle='#0e141d';cx.font='700 22px Trebuchet MS';cx.fillText('A',cur.start.x+12,cur.start.y-74);
cx.fillStyle='#8dffab';cx.fillRect(cur.goal.x-12,cur.goal.y-100,12,100);cx.fillStyle='#ddffe7';cx.fillRect(cur.goal.x,cur.goal.y-92,52,28);cx.fillStyle='#102016';cx.fillText('B',cur.goal.x+16,cur.goal.y-70);
for(const t of cur.plats){if(t.type==='crumble'&&t.gone)continue;const pg=cx.createLinearGradient(t.x,t.y,t.x,t.y+t.h);pg.addColorStop(0,t.type==='crumble'?'#8a7f5d':'#46566d');pg.addColorStop(1,t.type==='crumble'?'#58503a':'#2e3948');cx.fillStyle=pg;rr(t.x,t.y,t.w,t.h,4);cx.fill();cx.fillStyle='rgba(255,255,255,.14)';cx.fillRect(t.x+2,t.y+2,t.w-4,2)}
for(const t of cur.spikes){const n=Math.max(1,Math.ceil(t.w/28)),sw=t.w/n;for(let i=0;i<n;i++){cx.fillStyle='#aeb8c6';cx.beginPath();const xx=t.x+i*sw;cx.moveTo(xx,t.y+t.h);cx.lineTo(xx+sw*.5,t.y);cx.lineTo(xx+sw,t.y+t.h);cx.closePath();cx.fill()}}
for(const l of cur.lasers){const a=((et+l.ph)%l.per)<l.on;cx.fillStyle='#2b3444';rr(l.x-6,l.y-8,28,l.h+16,6);cx.fill();cx.fillStyle=a?'rgba(255,75,75,.88)':'rgba(255,75,75,.18)';cx.fillRect(l.x,l.y,l.w,l.h);if(a){cx.fillStyle='rgba(255,210,210,.92)';cx.fillRect(l.x+5,l.y,4,l.h)}}
for(const sw of cur.saws){const tt=et*sw.sp+sw.ph,x=sw.cx+(sw.a==='x'?Math.sin(tt)*sw.amp:0),y=sw.cy+(sw.a==='y'?Math.sin(tt)*sw.amp:0);cx.strokeStyle='rgba(220,235,255,.24)';cx.lineWidth=3;cx.beginPath();if(sw.a==='x'){cx.moveTo(sw.cx-sw.amp,sw.cy);cx.lineTo(sw.cx+sw.amp,sw.cy)}else{cx.moveTo(sw.cx,sw.cy-sw.amp);cx.lineTo(sw.cx,sw.cy+sw.amp)}cx.stroke();cx.save();cx.translate(x,y);cx.rotate(et*3.2);cx.drawImage(art.saw,-sw.r,-sw.r,sw.r*2,sw.r*2);cx.restore()}
hero(et);cx.restore()}
let prev=performance.now();resize();resetAll();requestAnimationFrame(function loop(now){const dt=Math.min(.033,(now-prev)/1000);prev=now;const et=(now-start)/1000;if(!done){update(dt,et);cam.x=cl(p.x-innerWidth*.34,0,cur.width-innerWidth);cam.y=cl(p.y-innerHeight*.56,0,cur.height-innerHeight)}draw(et);deathsEl.textContent='Смерти: '+deaths;timeEl.textContent='Время: '+et.toFixed(1)+'с';requestAnimationFrame(loop)});
</script>
</body>
</html>