<!doctype html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no" />
<title>Galactic Trial</title>
<style>
*{box-sizing:border-box}html,body{margin:0;width:100%;height:100%;overflow:hidden;touch-action:none;background:#060b12;color:#f0f6ff;font-family:Trebuchet MS,Segoe UI,sans-serif}
#game{position:fixed;inset:0;width:100vw;height:100vh;display:block}
#hud{position:fixed;top:max(10px,env(safe-area-inset-top));left:max(10px,env(safe-area-inset-left));right:max(10px,env(safe-area-inset-right));z-index:8;display:flex;justify-content:space-between;align-items:center;padding:10px 14px;border-radius:14px;background:linear-gradient(135deg,rgba(6,12,20,.72),rgba(16,29,45,.56));border:1px solid rgba(180,220,255,.22);backdrop-filter:blur(6px)}
#title{font-weight:900;letter-spacing:.08em}#st{font-weight:700}
#controls{position:fixed;z-index:10;left:max(10px,env(safe-area-inset-left));right:max(10px,env(safe-area-inset-right));bottom:max(10px,env(safe-area-inset-bottom));display:flex;justify-content:space-between;pointer-events:none}
.pad{display:flex;gap:10px;pointer-events:auto}.b{width:78px;height:78px;border-radius:18px;border:1px solid rgba(210,230,255,.44);background:linear-gradient(165deg,rgba(16,27,41,.9),rgba(10,18,28,.82));color:#fff;font-weight:900;font-size:22px;box-shadow:inset 0 1px 0 rgba(255,255,255,.2),0 10px 28px rgba(0,0,0,.35)}.b:active,.b.on{transform:translateY(2px) scale(.98)}
#rotate{position:fixed;inset:0;display:none;z-index:20;place-items:center;text-align:center;padding:24px;background:rgba(2,6,10,.95);font-size:6vw;font-weight:900}
#win{position:fixed;inset:0;display:none;z-index:15;place-items:center;background:rgba(0,0,0,.74)}#win>div{background:linear-gradient(145deg,#101b2a,#0a1320);padding:24px;border:1px solid rgba(190,220,255,.35);border-radius:16px;text-align:center;box-shadow:0 30px 80px rgba(0,0,0,.5)}
@media (orientation:portrait){#rotate{display:grid}#game,#hud,#controls{filter:blur(2px) brightness(.7)}}
</style>
</head>
<body>
<div id="rotate">Переверни телефон в горизонтальный режим</div>
<div id="hud"><span id="title">GALACTIC TRIAL</span><span id="st">Смерти: 0 | Время: 0.0с</span></div>
<canvas id="game"></canvas>
<div id="controls"><div class="pad"><button id="l" class="b">◀</button><button id="r" class="b">▶</button></div><div class="pad"><button id="j" class="b">J</button><button id="d" class="b">D</button></div></div>
<div id="win"><div><h2>Точка B достигнута</h2><p id="res"></p><button id="retry" class="b" style="width:190px;height:56px;font-size:16px">Еще раз</button></div></div>
<script>
const cv=document.getElementById('game'),cx=cv.getContext('2d'),st=document.getElementById('st'),win=document.getElementById('win'),res=document.getElementById('res');
const W={w:5200,h:1250},A={x:100,y:900},B={x:5000,y:180,w:70,h:100};
const p={x:A.x,y:A.y,w:34,h:44,vx:0,vy:0,f:1,g:false,c:0,jb:0,dc:0,ds:0,dd:1};
const ph={spd:360,acc:3000,fr:3400,gr:2100,j:810,mf:1250,ct:.09,jbt:.12,dh:840,dd:.16,cd:.72};
let deaths=0,start=performance.now(),done=false,cam={x:0,y:0},keys=new Set(),inp={l:false,r:false,j:false,d:false};
const svgImg=s=>{const i=new Image();i.decoding='async';i.src='data:image/svg+xml;utf8,'+encodeURIComponent(s);return i};
const art={
spike:svgImg(`<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 220 60'><g fill='#9da7b9'><path d='M0 60 L16 8 L32 60Z'/><path d='M28 60 L44 6 L60 60Z'/><path d='M56 60 L72 10 L88 60Z'/><path d='M84 60 L100 6 L116 60Z'/><path d='M112 60 L128 8 L144 60Z'/><path d='M140 60 L156 6 L172 60Z'/><path d='M168 60 L184 10 L200 60Z'/><path d='M196 60 L210 8 L220 60Z'/></g></svg>`),
saw:svgImg(`<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 160 160'><defs><radialGradient id='m' cx='50%' cy='50%' r='50%'><stop offset='0' stop-color='#f1f6ff'/><stop offset='1' stop-color='#8a96ab'/></radialGradient></defs><g transform='translate(80,80)'><path d='M0,-72 L10,-52 L32,-64 L28,-40 L52,-38 L36,-20 L58,-8 L34,2 L44,24 L20,20 L16,46 L0,28 L-16,46 L-20,20 L-44,24 L-34,2 L-58,-8 L-36,-20 L-52,-38 L-28,-40 L-32,-64 L-10,-52 Z' fill='url(#m)'/><circle r='27' fill='#5f6f83'/><circle r='10' fill='#d9e6f8'/></g></svg>`),
emitter:svgImg(`<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 80 220'><rect x='18' y='0' width='44' height='220' rx='12' fill='#111827'/><rect x='30' y='8' width='20' height='204' rx='8' fill='#2c374a'/></svg>`)
};
let actx=null,aReady=false,lastTaunt=0;
function audioOn(){if(!actx){const C=window.AudioContext||window.webkitAudioContext;if(!C)return;actx=new C()}if(actx.state==='suspended')actx.resume();aReady=true}
function sfx(t){if(!actx||!aReady)return;const n=actx.currentTime,o=actx.createOscillator(),g=actx.createGain();o.connect(g);g.connect(actx.destination);if(t==='jump'){o.type='triangle';o.frequency.setValueAtTime(280,n);o.frequency.exponentialRampToValueAtTime(520,n+.09);g.gain.setValueAtTime(.0001,n);g.gain.exponentialRampToValueAtTime(.06,n+.01);g.gain.exponentialRampToValueAtTime(.0001,n+.11);o.start(n);o.stop(n+.12);return}if(t==='dash'){o.type='sawtooth';o.frequency.setValueAtTime(145,n);o.frequency.exponentialRampToValueAtTime(92,n+.12);g.gain.setValueAtTime(.0001,n);g.gain.exponentialRampToValueAtTime(.09,n+.01);g.gain.exponentialRampToValueAtTime(.0001,n+.14);o.start(n);o.stop(n+.15);return}if(t==='death'){o.type='square';o.frequency.setValueAtTime(180,n);o.frequency.exponentialRampToValueAtTime(58,n+.3);g.gain.setValueAtTime(.0001,n);g.gain.exponentialRampToValueAtTime(.09,n+.01);g.gain.exponentialRampToValueAtTime(.0001,n+.32);o.start(n);o.stop(n+.33);return}o.type='triangle';o.frequency.setValueAtTime(330,n);o.frequency.exponentialRampToValueAtTime(660,n+.22);g.gain.setValueAtTime(.0001,n);g.gain.exponentialRampToValueAtTime(.07,n+.02);g.gain.exponentialRampToValueAtTime(.0001,n+.28);o.start(n);o.stop(n+.29)}
function taunt(){if(!('speechSynthesis' in window))return;const now=performance.now();if(now-lastTaunt<1400)return;lastTaunt=now;const u=new SpeechSynthesisUtterance('ТЫ НЕ ПРОЙДЕШ ахахахахах!');u.lang='ru-RU';u.rate=.9;u.pitch=.65;u.volume=1;window.speechSynthesis.cancel();window.speechSynthesis.speak(u)}
const plats=[{x:0,y:1060,w:500,h:190},{x:620,y:970,w:140,h:24},{x:860,y:900,w:150,h:24},{x:1120,y:830,w:150,h:24},{x:1390,y:760,w:200,h:24},{x:1670,y:860,w:120,h:22,c:1,t:0,g:0,re:0},{x:1870,y:770,w:120,h:22,c:1,t:0,g:0,re:0},{x:2070,y:680,w:120,h:22,c:1,t:0,g:0,re:0},{x:2280,y:600,w:130,h:22,c:1,t:0,g:0,re:0},{x:2500,y:540,w:150,h:24},{x:2780,y:540,w:170,h:22},{x:3020,y:540,w:120,h:22},{x:3220,y:530,w:120,h:22},{x:3420,y:500,w:120,h:22},{x:3620,y:460,w:120,h:22},{x:3820,y:420,w:120,h:22},{x:4040,y:350,w:220,h:24},{x:4340,y:290,w:150,h:24},{x:4560,y:240,w:90,h:20},{x:4740,y:210,w:90,h:20},{x:4920,y:180,w:90,h:20},{x:5000,y:150,w:280,h:26}];
const spikes=[{x:520,y:1042,w:90,h:18},{x:760,y:1042,w:210,h:18},{x:1010,y:1042,w:320,h:18},{x:1570,y:1042,w:540,h:18},{x:2570,y:1042,w:900,h:18},{x:2460,y:522,w:100,h:18},{x:4050,y:332,w:180,h:18},{x:5010,y:132,w:170,h:18}];
const saws=[{cx:920,cy:980,r:27,a:'y',amp:180,s:2.2,p:0},{cx:2100,cy:860,r:23,a:'x',amp:230,s:2.8,p:1.4},{cx:3300,cy:690,r:27,a:'y',amp:200,s:2.6,p:2.7},{cx:4380,cy:490,r:22,a:'x',amp:150,s:3.1,p:.8},{cx:4700,cy:410,r:22,a:'y',amp:140,s:3.4,p:2.1}];
const lasers=[{x:2850,y:340,w:16,h:720,per:1.7,on:1,ph:0},{x:3510,y:240,w:16,h:780,per:1.4,on:.85,ph:.5},{x:4610,y:40,w:16,h:980,per:1.1,on:.6,ph:.2}];
const cl=(v,mn,mx)=>Math.max(mn,Math.min(mx,v)),hit=(a,b)=>a.x<b.x+b.w&&a.x+a.w>b.x&&a.y<b.y+b.h&&a.y+a.h>b.y;
const chr=(x,y,r,o)=>{const nx=cl(x,o.x,o.x+o.w),ny=cl(y,o.y,o.y+o.h),dx=x-nx,dy=y-ny;return dx*dx+dy*dy<=r*r};
function rr(x,y,w,h,r){cx.beginPath();cx.moveTo(x+r,y);cx.arcTo(x+w,y,x+w,y+h,r);cx.arcTo(x+w,y+h,x,y+h,r);cx.arcTo(x,y+h,x,y,r);cx.arcTo(x,y,x+w,y,r);cx.closePath()}
function rs(){cv.width=innerWidth*devicePixelRatio;cv.height=innerHeight*devicePixelRatio;cx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0)}
function resetPlayer(){p.x=A.x;p.y=A.y;p.vx=0;p.vy=0;p.g=false;p.c=0;p.jb=0;p.ds=0}
function fullReset(){deaths=0;start=performance.now();done=false;for(const t of plats)if(t.c){t.t=0;t.g=0;t.re=0}resetPlayer();win.style.display='none'}
function die(){if(done)return;sfx('death');taunt();deaths++;resetPlayer()}
function bind(id,down,up){const b=document.getElementById(id);const on=e=>{e.preventDefault();audioOn();b.classList.add('on');down()};const off=e=>{e.preventDefault();b.classList.remove('on');up()};b.addEventListener('touchstart',on,{passive:false});b.addEventListener('mousedown',on);['touchend','touchcancel','mouseup','mouseleave'].forEach(ev=>b.addEventListener(ev,off))}
bind('l',()=>inp.l=true,()=>inp.l=false);bind('r',()=>inp.r=true,()=>inp.r=false);bind('j',()=>inp.j=true,()=>{});bind('d',()=>inp.d=true,()=>{});
addEventListener('keydown',e=>{audioOn();keys.add(e.code);if(['ArrowUp','Space','KeyW'].includes(e.code))inp.j=true;if(['ShiftLeft','ShiftRight','KeyK'].includes(e.code))inp.d=true});
addEventListener('keyup',e=>keys.delete(e.code));addEventListener('resize',rs);document.getElementById('retry').onclick=fullReset;
function upd(dt,et){for(const t of plats)if(t.c&&t.g){t.re-=dt;if(t.re<=0){t.g=0;t.t=0}};const ml=inp.l||keys.has('ArrowLeft')||keys.has('KeyA'),mr=inp.r||keys.has('ArrowRight')||keys.has('KeyD'),m=(mr?1:0)-(ml?1:0);if(m)p.f=m;if(inp.j)p.jb=ph.jbt;if(inp.d&&p.dc<=0&&!p.ds){sfx('dash');p.ds=ph.dd;p.dd=m||p.f||1;p.vx=p.dd*ph.dh;p.vy=0;p.dc=ph.cd}inp.j=false;inp.d=false;p.jb-=dt;p.c-=dt;p.dc-=dt;
if(p.ds>0){p.ds-=dt;p.vx=p.dd*ph.dh;p.vy=0}else{const tgt=m*ph.spd;if(m){const dir=Math.sign(tgt-p.vx);p.vx+=dir*ph.acc*dt;if((dir>0&&p.vx>tgt)||(dir<0&&p.vx<tgt))p.vx=tgt}else{const f=Math.sign(p.vx),a=ph.fr*dt;p.vx=Math.abs(p.vx)<=a?0:p.vx-f*a}p.vy=Math.min(p.vy+ph.gr*dt,ph.mf)}
if(p.jb>0&&(p.g||p.c>0)){sfx('jump');p.vy=-ph.j;p.g=false;p.c=0;p.jb=0}
const sols=plats.filter(t=>!t.c||!t.g);p.x+=p.vx*dt;for(const t of sols){if(!hit(p,t))continue;if(p.vx>0)p.x=t.x-p.w;else if(p.vx<0)p.x=t.x+t.w;p.vx=0}
p.y+=p.vy*dt;p.g=false;for(const t of sols){if(!hit(p,t))continue;if(p.vy>0){p.y=t.y-p.h;p.vy=0;p.g=true;p.c=ph.ct;if(t.c){t.t+=dt;if(t.t>.3){t.g=1;t.re=2.8}}}else if(p.vy<0){p.y=t.y+t.h;p.vy=0}}
if(!p.g)for(const t of plats)if(t.c)t.t=0;p.x=cl(p.x,0,W.w-p.w);for(const s of spikes)if(hit(p,s))return die();for(const s of saws){const tt=et*s.s+s.p,x=s.cx+(s.a==='x'?Math.sin(tt)*s.amp:0),y=s.cy+(s.a==='y'?Math.sin(tt)*s.amp:0);if(chr(x,y,s.r,p))return die()}for(const l of lasers){const a=((et+l.ph)%l.per)<l.on;if(a&&hit(p,l))return die()}if(p.y>W.h+120)return die();if(hit(p,B)){done=true;sfx('win');win.style.display='grid';res.textContent=`Смерти: ${deaths} | Время: ${((performance.now()-start)/1000).toFixed(2)}с`}}
function drawHero(et){const bw=54,bh=82,bx=p.x+(p.w-bw)*.5,by=p.y+p.h-bh+3,mv=Math.abs(p.vx)>45,phase=et*14*(mv?1:0)+Math.abs(p.vx)*.01,swing=(mv?1:.2)*Math.sin(phase)*.45,tr=p.ds>0?5:mv?2:0;
cx.save();if(p.f<0){cx.translate(bx+bw*.5,0);cx.scale(-1,1);cx.translate(-(bx+bw*.5),0)}
for(let i=tr;i>=1;i--){cx.globalAlpha=.06+i*.04;const sh=i*(p.ds>0?7:4),sy=Math.sin(et*20+i)*1.2;drawHeroBody(bx-sh,by+sy,swing*.6,true)}cx.globalAlpha=1;drawHeroBody(bx,by,swing,false);if(mv||p.ds>0){const len=p.ds>0?50:32,pulse=.4+Math.abs(Math.sin(et*19))*.45;cx.fillStyle=`rgba(255,68,68,${pulse})`;cx.fillRect(bx+bw-4,by+34,len,4);cx.fillStyle=`rgba(255,194,194,${pulse*.8})`;cx.fillRect(bx+bw-4,by+35,len,2)}cx.restore()}
function drawHeroBody(x,y,swing,ghost){cx.save();if(ghost)cx.filter='blur(1px)';
const cape=cx.createLinearGradient(x,y+8,x+54,y+82);cape.addColorStop(0,'#131720');cape.addColorStop(1,'#2a3140');cx.fillStyle=cape;cx.beginPath();cx.moveTo(x+8,y+26);cx.lineTo(x-4,y+78);cx.lineTo(x+22,y+70);cx.lineTo(x+50,y+82);cx.lineTo(x+42,y+30);cx.closePath();cx.fill();
cx.save();cx.translate(x+20,y+52);cx.rotate(swing);cx.fillStyle='#141b26';rr(-8,0,16,28,6);cx.fill();cx.restore();
cx.save();cx.translate(x+34,y+52);cx.rotate(-swing);cx.fillStyle='#141b26';rr(-8,0,16,28,6);cx.fill();cx.restore();
cx.fillStyle='#1e2633';rr(x+12,y+24,30,28,8);cx.fill();cx.fillStyle='#0f141e';rr(x+18,y+28,18,12,3);cx.fill();cx.fillStyle='#7ff6c0';cx.fillRect(x+19,y+29,3,3);cx.fillStyle='#74d7ff';cx.fillRect(x+24,y+29,3,3);cx.fillStyle='#ff7171';cx.fillRect(x+29,y+29,3,3);
cx.fillStyle='#111723';cx.beginPath();cx.ellipse(x+27,y+14,12,14,0,0,Math.PI*2);cx.fill();cx.fillStyle='#293444';cx.beginPath();cx.ellipse(x+27,y+12,8,8,0,0,Math.PI*2);cx.fill();cx.fillStyle='#d5e1f5';cx.fillRect(x+22,y+15,3,2);cx.fillRect(x+29,y+15,3,2);
cx.restore()}
function draw(et){const w=innerWidth,h=innerHeight;const g=cx.createLinearGradient(0,0,0,h);g.addColorStop(0,'#040810');g.addColorStop(.58,'#0d1a2b');g.addColorStop(1,'#1e3652');cx.fillStyle=g;cx.fillRect(0,0,w,h);for(let i=0;i<90;i++){const px=(i*173-et*18*(1+i%3*.3))%w,py=(i*97)%h;cx.fillStyle=`rgba(215,232,255,${.2+(i%5)*.08})`;cx.fillRect(px,py,2,2)}
for(let n=0;n<5;n++){cx.fillStyle=`rgba(102,141,196,${.06+n*.02})`;cx.beginPath();cx.ellipse((n*390-et*8*(n+1))%(w+500)-250,150+n*70,220,70,0,0,Math.PI*2);cx.fill()}
cx.save();cx.translate(-cam.x,-cam.y);
cx.fillStyle='#8fd2ff';cx.fillRect(A.x-12,A.y-100,12,100);cx.fillStyle='#dff5ff';cx.fillRect(A.x,A.y-92,42,24);cx.fillStyle='#0e141d';cx.font='700 22px Trebuchet MS';cx.fillText('A',A.x+12,A.y-74);
cx.fillStyle='#8dffab';cx.fillRect(B.x-12,B.y-100,12,100);cx.fillStyle='#ddffe7';cx.fillRect(B.x,B.y-92,52,28);cx.fillStyle='#102016';cx.fillText('B',B.x+16,B.y-70);
for(const t of plats){if(t.c&&t.g)continue;const pg=cx.createLinearGradient(t.x,t.y,t.x,t.y+t.h);pg.addColorStop(0,t.c?'#8a7f5d':'#46566d');pg.addColorStop(1,t.c?'#58503a':'#2e3948');cx.fillStyle=pg;rr(t.x,t.y,t.w,t.h,4);cx.fill();cx.fillStyle='rgba(255,255,255,.14)';cx.fillRect(t.x+2,t.y+2,t.w-4,2)}
for(const s of spikes){const n=Math.max(1,Math.ceil(s.w/28)),sw=s.w/n;for(let i=0;i<n;i++)cx.drawImage(art.spike,s.x+i*sw,s.y-1,sw+1,s.h+3)}
for(const l of lasers){const a=((et+l.ph)%l.per)<l.on;cx.drawImage(art.emitter,l.x-32,l.y-6,80,l.h+12);cx.fillStyle=a?'rgba(255,75,75,.88)':'rgba(255,75,75,.18)';cx.fillRect(l.x,l.y,l.w,l.h);if(a){cx.fillStyle='rgba(255,210,210,.92)';cx.fillRect(l.x+5,l.y,4,l.h)}}
for(const s of saws){const tt=et*s.s+s.p,x=s.cx+(s.a==='x'?Math.sin(tt)*s.amp:0),y=s.cy+(s.a==='y'?Math.sin(tt)*s.amp:0);cx.strokeStyle='rgba(220,235,255,.24)';cx.lineWidth=3;cx.beginPath();if(s.a==='x'){cx.moveTo(s.cx-s.amp,s.cy);cx.lineTo(s.cx+s.amp,s.cy)}else{cx.moveTo(s.cx,s.cy-s.amp);cx.lineTo(s.cx,s.cy+s.amp)}cx.stroke();cx.save();cx.translate(x,y);cx.rotate(et*3.2);cx.drawImage(art.saw,-s.r,-s.r,s.r*2,s.r*2);cx.restore()}
drawHero(et);cx.restore()}
let prv=performance.now();rs();fullReset();requestAnimationFrame(function loop(now){const dt=Math.min(.033,(now-prv)/1000);prv=now;const et=(now-start)/1000;if(!done){upd(dt,et);cam.x=cl(p.x-innerWidth*.34,0,W.w-innerWidth);cam.y=cl(p.y-innerHeight*.56,0,W.h-innerHeight)}draw(et);st.textContent=`Смерти: ${deaths} | Время: ${et.toFixed(1)}с`;requestAnimationFrame(loop)});
</script>
</body>
</html>