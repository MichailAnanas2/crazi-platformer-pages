<!doctype html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no" />
<title>Crazi A2B</title>
<style>
*{box-sizing:border-box}html,body{margin:0;width:100%;height:100%;overflow:hidden;touch-action:none;background:radial-gradient(circle at 30% 20%,#101725,#0a1018 58%,#060b12);font-family:Trebuchet MS,Segoe UI,sans-serif;color:#eef7ff}
#game{position:fixed;inset:0;width:100vw;height:100vh;display:block}
#hud{position:fixed;top:max(8px,env(safe-area-inset-top));left:max(8px,env(safe-area-inset-left));right:max(8px,env(safe-area-inset-right));z-index:5;display:flex;justify-content:space-between;background:rgba(0,0,0,.38);padding:8px 12px;border-radius:10px;font-weight:700}
#controls{position:fixed;z-index:10;left:max(8px,env(safe-area-inset-left));right:max(8px,env(safe-area-inset-right));bottom:max(8px,env(safe-area-inset-bottom));display:flex;justify-content:space-between;pointer-events:none}
.pad{display:flex;gap:8px;pointer-events:auto}.b{width:76px;height:76px;border-radius:16px;border:2px solid rgba(200,220,255,.45);background:rgba(18,27,40,.84);color:#fff;font-weight:800;font-size:20px}.b:active,.b.on{transform:translateY(2px) scale(.98)}
#rotate{position:fixed;inset:0;display:none;z-index:20;place-items:center;text-align:center;padding:24px;background:rgba(5,9,14,.95);font-size:6vw;font-weight:800}
#win{position:fixed;inset:0;display:none;z-index:15;place-items:center;background:rgba(0,0,0,.7)}#win>div{background:#101a28;padding:20px;border:2px solid rgba(220,230,255,.35);border-radius:14px;text-align:center}
@media (orientation:portrait){#rotate{display:grid}#game,#hud,#controls{filter:blur(2px) brightness(.75)}}
</style>
</head>
<body>
<div id="rotate">Переверни телефон в горизонтальный режим</div>
<div id="hud"><span>GALACTIC HARDCORE</span><span id="st">Смерти: 0 | Время: 0.0с</span></div>
<canvas id="game"></canvas>
<div id="controls"><div class="pad"><button id="l" class="b">◀</button><button id="r" class="b">▶</button></div><div class="pad"><button id="j" class="b">J</button><button id="d" class="b">D</button></div></div>
<div id="win"><div><h2>Миссия завершена</h2><p id="res"></p><button id="retry" class="b" style="width:180px;height:54px;font-size:16px">Еще раз</button></div></div>
<script>
const cv=document.getElementById('game'),cx=cv.getContext('2d'),st=document.getElementById('st'),win=document.getElementById('win'),res=document.getElementById('res');
const W={w:5200,h:1250},A={x:100,y:900},B={x:5000,y:180,w:70,h:100};
const p={x:A.x,y:A.y,w:34,h:44,vx:0,vy:0,f:1,g:false,c:0,jb:0,dc:0,ds:0,dd:1};
const ph={spd:360,acc:3000,fr:3400,gr:2100,j:810,mf:1250,ct:.09,jbt:.12,dh:840,dd:.16,cd:.72};
let deaths=0,start=performance.now(),done=false,cam={x:0,y:0},keys=new Set(),inp={l:false,r:false,j:false,d:false};
const svgImg=s=>{const i=new Image();i.decoding='async';i.src='data:image/svg+xml;utf8,'+encodeURIComponent(s);return i};
const art={
hero:svgImg(`<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512'><defs><linearGradient id='cape' x1='0' y1='0' x2='1' y2='1'><stop offset='0' stop-color='#0f1118'/><stop offset='1' stop-color='#242a36'/></linearGradient><linearGradient id='armor' x1='0' y1='0' x2='0' y2='1'><stop offset='0' stop-color='#3e4759'/><stop offset='1' stop-color='#171d29'/></linearGradient></defs><path d='M110 412 L206 190 L156 188 L52 388 Z' fill='url(#cape)'/><path d='M230 176 C290 172 338 196 368 236 L328 410 L176 410 L146 236 C172 196 198 180 230 176 Z' fill='url(#armor)'/><ellipse cx='256' cy='116' rx='68' ry='72' fill='#121722'/><ellipse cx='256' cy='104' rx='46' ry='42' fill='#242d3b'/><path d='M210 128 L302 128 L292 166 L220 166 Z' fill='#0e121a'/><circle cx='234' cy='145' r='5' fill='#d0ddf0'/><circle cx='278' cy='145' r='5' fill='#d0ddf0'/><rect x='230' y='196' width='52' height='32' rx='3' fill='#141a24'/><rect x='236' y='202' width='12' height='8' fill='#f55353'/><rect x='250' y='202' width='12' height='8' fill='#85e7ff'/><rect x='264' y='202' width='12' height='8' fill='#8bf0a6'/><rect x='182' y='236' width='38' height='130' rx='15' fill='#1b222f'/><rect x='292' y='236' width='38' height='130' rx='15' fill='#1b222f'/><rect x='164' y='342' width='74' height='54' rx='16' fill='#0f131c'/><rect x='274' y='342' width='74' height='54' rx='16' fill='#0f131c'/><rect x='328' y='236' width='140' height='10' rx='4' fill='#ff5353'/><rect x='328' y='238' width='140' height='6' rx='3' fill='#ffc7c7' opacity='.55'/></svg>`),
spike:svgImg(`<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 220 60'><g fill='#8d97a8'><path d='M0 60 L16 8 L32 60Z'/><path d='M28 60 L44 6 L60 60Z'/><path d='M56 60 L72 10 L88 60Z'/><path d='M84 60 L100 6 L116 60Z'/><path d='M112 60 L128 8 L144 60Z'/><path d='M140 60 L156 6 L172 60Z'/><path d='M168 60 L184 10 L200 60Z'/><path d='M196 60 L210 8 L220 60Z'/></g></svg>`),
saw:svgImg(`<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 160 160'><defs><radialGradient id='m' cx='50%' cy='50%' r='50%'><stop offset='0' stop-color='#eaf3ff'/><stop offset='1' stop-color='#8794a8'/></radialGradient></defs><g transform='translate(80,80)'><path d='M0,-72 L10,-52 L32,-64 L28,-40 L52,-38 L36,-20 L58,-8 L34,2 L44,24 L20,20 L16,46 L0,28 L-16,46 L-20,20 L-44,24 L-34,2 L-58,-8 L-36,-20 L-52,-38 L-28,-40 L-32,-64 L-10,-52 Z' fill='url(#m)'/><circle r='28' fill='#5f6f83'/><circle r='10' fill='#d9e6f8'/></g></svg>`),
emitter:svgImg(`<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 80 220'><rect x='18' y='0' width='44' height='220' rx='12' fill='#121723'/><rect x='30' y='8' width='20' height='204' rx='8' fill='#323c4d'/></svg>`)
};
let actx=null,aReady=false;function audioOn(){if(!actx){const C=window.AudioContext||window.webkitAudioContext;if(!C)return;actx=new C()}if(actx.state==='suspended')actx.resume();aReady=true}
function sfx(t){if(!actx||!aReady)return;const n=actx.currentTime,o=actx.createOscillator(),g=actx.createGain();o.connect(g);g.connect(actx.destination);if(t==='jump'){o.type='triangle';o.frequency.setValueAtTime(280,n);o.frequency.exponentialRampToValueAtTime(520,n+.09);g.gain.setValueAtTime(.0001,n);g.gain.exponentialRampToValueAtTime(.06,n+.01);g.gain.exponentialRampToValueAtTime(.0001,n+.11);o.start(n);o.stop(n+.12);return}if(t==='dash'){o.type='sawtooth';o.frequency.setValueAtTime(140,n);o.frequency.exponentialRampToValueAtTime(90,n+.12);g.gain.setValueAtTime(.0001,n);g.gain.exponentialRampToValueAtTime(.08,n+.01);g.gain.exponentialRampToValueAtTime(.0001,n+.14);o.start(n);o.stop(n+.15);return}if(t==='death'){o.type='square';o.frequency.setValueAtTime(180,n);o.frequency.exponentialRampToValueAtTime(60,n+.3);g.gain.setValueAtTime(.0001,n);g.gain.exponentialRampToValueAtTime(.09,n+.01);g.gain.exponentialRampToValueAtTime(.0001,n+.32);o.start(n);o.stop(n+.33);return}o.type='triangle';o.frequency.setValueAtTime(330,n);o.frequency.exponentialRampToValueAtTime(660,n+.22);g.gain.setValueAtTime(.0001,n);g.gain.exponentialRampToValueAtTime(.07,n+.02);g.gain.exponentialRampToValueAtTime(.0001,n+.28);o.start(n);o.stop(n+.29)}
const plats=[{x:0,y:1060,w:500,h:190},{x:620,y:970,w:140,h:24},{x:860,y:900,w:150,h:24},{x:1120,y:830,w:150,h:24},{x:1390,y:760,w:200,h:24},{x:1670,y:860,w:120,h:22,c:1,t:0,g:0,re:0},{x:1870,y:770,w:120,h:22,c:1,t:0,g:0,re:0},{x:2070,y:680,w:120,h:22,c:1,t:0,g:0,re:0},{x:2280,y:600,w:130,h:22,c:1,t:0,g:0,re:0},{x:2500,y:540,w:150,h:24},{x:2780,y:540,w:170,h:22},{x:3020,y:540,w:120,h:22},{x:3220,y:530,w:120,h:22},{x:3420,y:500,w:120,h:22},{x:3620,y:460,w:120,h:22},{x:3820,y:420,w:120,h:22},{x:4040,y:350,w:220,h:24},{x:4340,y:290,w:150,h:24},{x:4560,y:240,w:90,h:20},{x:4740,y:210,w:90,h:20},{x:4920,y:180,w:90,h:20},{x:5000,y:150,w:280,h:26}];
const spikes=[{x:520,y:1042,w:90,h:18},{x:760,y:1042,w:210,h:18},{x:1010,y:1042,w:320,h:18},{x:1570,y:1042,w:540,h:18},{x:2570,y:1042,w:900,h:18},{x:2460,y:522,w:100,h:18},{x:4050,y:332,w:180,h:18},{x:5010,y:132,w:170,h:18}];
const saws=[{cx:920,cy:980,r:27,a:'y',amp:180,s:2.2,p:0},{cx:2100,cy:860,r:23,a:'x',amp:230,s:2.8,p:1.4},{cx:3300,cy:690,r:27,a:'y',amp:200,s:2.6,p:2.7},{cx:4380,cy:490,r:22,a:'x',amp:150,s:3.1,p:.8},{cx:4700,cy:410,r:22,a:'y',amp:140,s:3.4,p:2.1}];
const lasers=[{x:2850,y:340,w:16,h:720,per:1.7,on:1,ph:0},{x:3510,y:240,w:16,h:780,per:1.4,on:.85,ph:.5},{x:4610,y:40,w:16,h:980,per:1.1,on:.6,ph:.2}];
const cl=(v,mn,mx)=>Math.max(mn,Math.min(mx,v)),hit=(a,b)=>a.x<b.x+b.w&&a.x+a.w>b.x&&a.y<b.y+b.h&&a.y+a.h>b.y;
const chr=(x,y,r,o)=>{const nx=cl(x,o.x,o.x+o.w),ny=cl(y,o.y,o.y+o.h),dx=x-nx,dy=y-ny;return dx*dx+dy*dy<=r*r};
function rs(){cv.width=innerWidth*devicePixelRatio;cv.height=innerHeight*devicePixelRatio;cx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0)}
function resetPlayer(){p.x=A.x;p.y=A.y;p.vx=0;p.vy=0;p.g=false;p.c=0;p.jb=0;p.ds=0}
function fullReset(){deaths=0;start=performance.now();done=false;for(const t of plats)if(t.c){t.t=0;t.g=0;t.re=0}resetPlayer();win.style.display='none'}
function die(){if(done)return;sfx('death');deaths++;resetPlayer()}
function bind(id,down,up){const b=document.getElementById(id);const on=e=>{e.preventDefault();audioOn();b.classList.add('on');down()};const off=e=>{e.preventDefault();b.classList.remove('on');up()};b.addEventListener('touchstart',on,{passive:false});b.addEventListener('mousedown',on);['touchend','touchcancel','mouseup','mouseleave'].forEach(ev=>b.addEventListener(ev,off))}
bind('l',()=>inp.l=true,()=>inp.l=false);bind('r',()=>inp.r=true,()=>inp.r=false);bind('j',()=>inp.j=true,()=>{});bind('d',()=>inp.d=true,()=>{});
addEventListener('keydown',e=>{audioOn();keys.add(e.code);if(['ArrowUp','Space','KeyW'].includes(e.code))inp.j=true;if(['ShiftLeft','ShiftRight','KeyK'].includes(e.code))inp.d=true});
addEventListener('keyup',e=>keys.delete(e.code));addEventListener('resize',rs);document.getElementById('retry').onclick=fullReset;
function upd(dt,et){for(const t of plats)if(t.c&&t.g){t.re-=dt;if(t.re<=0){t.g=0;t.t=0}};const ml=inp.l||keys.has('ArrowLeft')||keys.has('KeyA'),mr=inp.r||keys.has('ArrowRight')||keys.has('KeyD'),m=(mr?1:0)-(ml?1:0);if(m)p.f=m;if(inp.j)p.jb=ph.jbt;if(inp.d&&p.dc<=0&&!p.ds){sfx('dash');p.ds=ph.dd;p.dd=m||p.f||1;p.vx=p.dd*ph.dh;p.vy=0;p.dc=ph.cd}inp.j=false;inp.d=false;p.jb-=dt;p.c-=dt;p.dc-=dt;
if(p.ds>0){p.ds-=dt;p.vx=p.dd*ph.dh;p.vy=0}else{const tgt=m*ph.spd;if(m){const dir=Math.sign(tgt-p.vx);p.vx+=dir*ph.acc*dt;if(dir>0&&p.vx>tgt||dir<0&&p.vx<tgt)p.vx=tgt}else{const f=Math.sign(p.vx),a=ph.fr*dt;p.vx=Math.abs(p.vx)<=a?0:p.vx-f*a}p.vy=Math.min(p.vy+ph.gr*dt,ph.mf)}
if(p.jb>0&&(p.g||p.c>0)){sfx('jump');p.vy=-ph.j;p.g=false;p.c=0;p.jb=0}
const sols=plats.filter(t=>!t.c||!t.g);p.x+=p.vx*dt;for(const t of sols){if(!hit(p,t))continue;if(p.vx>0)p.x=t.x-p.w;else if(p.vx<0)p.x=t.x+t.w;p.vx=0}
p.y+=p.vy*dt;p.g=false;for(const t of sols){if(!hit(p,t))continue;if(p.vy>0){p.y=t.y-p.h;p.vy=0;p.g=true;p.c=ph.ct;if(t.c){t.t+=dt;if(t.t>.3){t.g=1;t.re=2.8}}}else if(p.vy<0){p.y=t.y+t.h;p.vy=0}}
if(!p.g)for(const t of plats)if(t.c)t.t=0;p.x=cl(p.x,0,W.w-p.w);for(const s of spikes)if(hit(p,s))return die();for(const s of saws){const tt=et*s.s+s.p,x=s.cx+(s.a==='x'?Math.sin(tt)*s.amp:0),y=s.cy+(s.a==='y'?Math.sin(tt)*s.amp:0);if(chr(x,y,s.r,p))return die()}for(const l of lasers){const a=((et+l.ph)%l.per)<l.on;if(a&&hit(p,l))return die()}if(p.y>W.h+120)return die();if(hit(p,B)){done=true;sfx('win');win.style.display='grid';res.textContent=`Смерти: ${deaths} | Время: ${((performance.now()-start)/1000).toFixed(2)}с`}}
function drawPlayer(et){const bw=52,bh=76,bx=p.x+(p.w-bw)*.5,by=p.y+p.h-bh+2,mv=Math.abs(p.vx)>45,tr=p.ds>0?5:mv?2:0;
cx.save();if(p.f<0){cx.translate(bx+bw*.5,0);cx.scale(-1,1);cx.translate(-(bx+bw*.5),0)}for(let i=tr;i>=1;i--){const shf=i*(p.ds>0?6:4),swy=Math.sin(et*22+i)*1.4;cx.globalAlpha=.08+i*.04;cx.drawImage(art.hero,bx-shf,by+swy,bw,bh)}cx.globalAlpha=1;cx.drawImage(art.hero,bx,by,bw,bh);if(mv||p.ds>0){const len=p.ds>0?46:30,pulse=.35+Math.abs(Math.sin(et*20))*.45;cx.fillStyle=`rgba(255,70,70,${pulse})`;cx.fillRect(bx+bw-2,by+Math.floor(bh*.44),len,4);cx.fillStyle=`rgba(255,170,170,${pulse*.9})`;cx.fillRect(bx+bw-2,by+Math.floor(bh*.44)+1,len,2)}cx.restore()}
function draw(et){const w=innerWidth,h=innerHeight;const g=cx.createLinearGradient(0,0,0,h);g.addColorStop(0,'#050913');g.addColorStop(.6,'#101e31');g.addColorStop(1,'#1f3550');cx.fillStyle=g;cx.fillRect(0,0,w,h);for(let i=0;i<70;i++){const x=(i*173-et*16)%w,y=(i*97)%h;cx.fillStyle=`rgba(220,235,255,${.2+(i%5)*.07})`;cx.fillRect(x,y,2,2)}cx.save();cx.translate(-cam.x,-cam.y);
cx.fillStyle='#8fd2ff';cx.fillRect(A.x-12,A.y-100,12,100);cx.fillStyle='#dff5ff';cx.fillRect(A.x,A.y-92,42,24);cx.fillStyle='#0e141d';cx.font='700 22px Trebuchet MS';cx.fillText('A',A.x+12,A.y-74);
cx.fillStyle='#8dffab';cx.fillRect(B.x-12,B.y-100,12,100);cx.fillStyle='#ddffe7';cx.fillRect(B.x,B.y-92,52,28);cx.fillStyle='#102016';cx.fillText('B',B.x+16,B.y-70);
for(const t of plats){if(t.c&&t.g)continue;cx.fillStyle=t.c?'#6d674f':'#384354';cx.fillRect(t.x,t.y,t.w,t.h);cx.fillStyle='rgba(255,255,255,.08)';cx.fillRect(t.x,t.y,t.w,4)}
for(const s of spikes){const n=Math.max(1,Math.ceil(s.w/28)),sw=s.w/n;for(let i=0;i<n;i++)cx.drawImage(art.spike,s.x+i*sw,s.y-1,sw+1,s.h+3)}
for(const l of lasers){const a=((et+l.ph)%l.per)<l.on;cx.drawImage(art.emitter,l.x-32,l.y-6,80,l.h+12);cx.fillStyle=a?'rgba(255,75,75,.86)':'rgba(255,75,75,.2)';cx.fillRect(l.x,l.y,l.w,l.h);if(a){cx.fillStyle='rgba(255,210,210,.9)';cx.fillRect(l.x+5,l.y,4,l.h)}}
for(const s of saws){const tt=et*s.s+s.p,x=s.cx+(s.a==='x'?Math.sin(tt)*s.amp:0),y=s.cy+(s.a==='y'?Math.sin(tt)*s.amp:0);cx.strokeStyle='rgba(220,235,255,.2)';cx.lineWidth=3;cx.beginPath();if(s.a==='x'){cx.moveTo(s.cx-s.amp,s.cy);cx.lineTo(s.cx+s.amp,s.cy)}else{cx.moveTo(s.cx,s.cy-s.amp);cx.lineTo(s.cx,s.cy+s.amp)}cx.stroke();cx.save();cx.translate(x,y);cx.rotate(et*3.2);cx.drawImage(art.saw,-s.r,-s.r,s.r*2,s.r*2);cx.restore()}
drawPlayer(et);cx.restore()}
let prv=performance.now();rs();fullReset();requestAnimationFrame(function loop(now){const dt=Math.min(.033,(now-prv)/1000);prv=now;const et=(now-start)/1000;if(!done){upd(dt,et);cam.x=cl(p.x-innerWidth*.34,0,W.w-innerWidth);cam.y=cl(p.y-innerHeight*.56,0,W.h-innerHeight)}draw(et);st.textContent=`Смерти: ${deaths} | Время: ${et.toFixed(1)}с`;requestAnimationFrame(loop)});
</script>
</body>
</html>