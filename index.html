<!doctype html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no" />
<title>Crazi A2B</title>
<style>
*{box-sizing:border-box}html,body{margin:0;width:100%;height:100%;overflow:hidden;touch-action:none;background:radial-gradient(circle at 30% 20%,#284760,#101c2a 55%,#070c12);font-family:Trebuchet MS,Segoe UI,sans-serif;color:#eef7ff}
#game{position:fixed;inset:0;width:100vw;height:100vh;display:block}
#hud{position:fixed;top:max(8px,env(safe-area-inset-top));left:max(8px,env(safe-area-inset-left));right:max(8px,env(safe-area-inset-right));z-index:5;display:flex;justify-content:space-between;background:rgba(0,0,0,.35);padding:8px 12px;border-radius:10px;font-weight:700}
#controls{position:fixed;z-index:10;left:max(8px,env(safe-area-inset-left));right:max(8px,env(safe-area-inset-right));bottom:max(8px,env(safe-area-inset-bottom));display:flex;justify-content:space-between;pointer-events:none}
.pad{display:flex;gap:8px;pointer-events:auto}.b{width:76px;height:76px;border-radius:16px;border:2px solid rgba(255,255,255,.35);background:rgba(20,30,43,.8);color:#fff;font-weight:800;font-size:20px}.b:active,.b.on{transform:translateY(2px) scale(.98)}
#rotate{position:fixed;inset:0;display:none;z-index:20;place-items:center;text-align:center;padding:24px;background:rgba(5,9,14,.95);font-size:6vw;font-weight:800}
#win{position:fixed;inset:0;display:none;z-index:15;place-items:center;background:rgba(0,0,0,.7)}#win>div{background:#122030;padding:20px;border:2px solid rgba(255,255,255,.3);border-radius:14px;text-align:center}
@media (orientation:portrait){#rotate{display:grid}#game,#hud,#controls{filter:blur(2px) brightness(.75)}}
</style>
</head>
<body>
<div id="rotate">Переверни телефон в горизонтальный режим</div>
<div id="hud"><span>A2B HARDCORE</span><span id="st">Смерти: 0 | Время: 0.0с</span></div>
<canvas id="game"></canvas>
<div id="controls"><div class="pad"><button id="l" class="b">◀</button><button id="r" class="b">▶</button></div><div class="pad"><button id="j" class="b">J</button><button id="d" class="b">D</button></div></div>
<div id="win"><div><h2>Точка B достигнута</h2><p id="res"></p><button id="retry" class="b" style="width:180px;height:54px;font-size:16px">Еще раз</button></div></div>
<script>
const cv=document.getElementById('game'),cx=cv.getContext('2d'),st=document.getElementById('st'),win=document.getElementById('win'),res=document.getElementById('res');
const W={w:5200,h:1250},A={x:100,y:900},B={x:5000,y:180,w:70,h:100};
const p={x:A.x,y:A.y,w:34,h:44,vx:0,vy:0,f:1,g:false,c:0,jb:0,dc:0,ds:0,dd:1};
const ph={spd:360,acc:3000,fr:3400,gr:2100,j:810,mf:1250,ct:.09,jbt:.12,dh:840,dd:.16,cd:.72};
let deaths=0,start=performance.now(),done=false,cam={x:0,y:0},keys=new Set(),inp={l:false,r:false,j:false,d:false};
const plats=[{x:0,y:1060,w:500,h:190},{x:620,y:970,w:140,h:24},{x:860,y:900,w:150,h:24},{x:1120,y:830,w:150,h:24},{x:1390,y:760,w:200,h:24},{x:1670,y:860,w:120,h:22,c:1,t:0,g:0,re:0},{x:1870,y:770,w:120,h:22,c:1,t:0,g:0,re:0},{x:2070,y:680,w:120,h:22,c:1,t:0,g:0,re:0},{x:2280,y:600,w:130,h:22,c:1,t:0,g:0,re:0},{x:2500,y:540,w:150,h:24},{x:2780,y:540,w:170,h:22},{x:3020,y:540,w:120,h:22},{x:3220,y:530,w:120,h:22},{x:3420,y:500,w:120,h:22},{x:3620,y:460,w:120,h:22},{x:3820,y:420,w:120,h:22},{x:4040,y:350,w:220,h:24},{x:4340,y:290,w:150,h:24},{x:4560,y:240,w:90,h:20},{x:4740,y:210,w:90,h:20},{x:4920,y:180,w:90,h:20},{x:5000,y:150,w:280,h:26}];
const spikes=[{x:520,y:1042,w:90,h:18},{x:760,y:1042,w:210,h:18},{x:1010,y:1042,w:320,h:18},{x:1570,y:1042,w:540,h:18},{x:2570,y:1042,w:900,h:18},{x:2460,y:522,w:100,h:18},{x:4050,y:332,w:180,h:18},{x:5010,y:132,w:170,h:18}];
const saws=[{cx:920,cy:980,r:27,a:'y',amp:180,s:2.2,p:0},{cx:2100,cy:860,r:23,a:'x',amp:230,s:2.8,p:1.4},{cx:3300,cy:690,r:27,a:'y',amp:200,s:2.6,p:2.7},{cx:4380,cy:490,r:22,a:'x',amp:150,s:3.1,p:.8},{cx:4700,cy:410,r:22,a:'y',amp:140,s:3.4,p:2.1}];
const lasers=[{x:2850,y:340,w:16,h:720,per:1.7,on:1,ph:0},{x:3510,y:240,w:16,h:780,per:1.4,on:.85,ph:.5},{x:4610,y:40,w:16,h:980,per:1.1,on:.6,ph:.2}];
const cl=(v,mn,mx)=>Math.max(mn,Math.min(mx,v)),hit=(a,b)=>a.x<b.x+b.w&&a.x+a.w>b.x&&a.y<b.y+b.h&&a.y+a.h>b.y;
const chr=(x,y,r,o)=>{const nx=cl(x,o.x,o.x+o.w),ny=cl(y,o.y,o.y+o.h),dx=x-nx,dy=y-ny;return dx*dx+dy*dy<=r*r};
function rs(){cv.width=innerWidth*devicePixelRatio;cv.height=innerHeight*devicePixelRatio;cx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0)}
function resetPlayer(){p.x=A.x;p.y=A.y;p.vx=0;p.vy=0;p.g=false;p.c=0;p.jb=0;p.ds=0}
function fullReset(){deaths=0;start=performance.now();done=false;for(const t of plats)if(t.c){t.t=0;t.g=0;t.re=0}resetPlayer();win.style.display='none'}
function die(){if(done)return;deaths++;resetPlayer()}
function bind(id,down,up){const b=document.getElementById(id);const on=e=>{e.preventDefault();b.classList.add('on');down()};const off=e=>{e.preventDefault();b.classList.remove('on');up()};b.addEventListener('touchstart',on,{passive:false});b.addEventListener('mousedown',on);['touchend','touchcancel','mouseup','mouseleave'].forEach(ev=>b.addEventListener(ev,off))}
bind('l',()=>inp.l=true,()=>inp.l=false);bind('r',()=>inp.r=true,()=>inp.r=false);bind('j',()=>inp.j=true,()=>{});bind('d',()=>inp.d=true,()=>{});
addEventListener('keydown',e=>{keys.add(e.code);if(['ArrowUp','Space','KeyW'].includes(e.code))inp.j=true;if(['ShiftLeft','ShiftRight','KeyK'].includes(e.code))inp.d=true});
addEventListener('keyup',e=>keys.delete(e.code));addEventListener('resize',rs);document.getElementById('retry').onclick=fullReset;
function upd(dt,et){for(const t of plats)if(t.c&&t.g){t.re-=dt;if(t.re<=0){t.g=0;t.t=0}};const ml=inp.l||keys.has('ArrowLeft')||keys.has('KeyA'),mr=inp.r||keys.has('ArrowRight')||keys.has('KeyD'),m=(mr?1:0)-(ml?1:0);if(m)p.f=m;if(inp.j)p.jb=ph.jbt;if(inp.d&&p.dc<=0&&!p.ds){p.ds=ph.dd;p.dd=m||p.f||1;p.vx=p.dd*ph.dh;p.vy=0;p.dc=ph.cd}inp.j=false;inp.d=false;p.jb-=dt;p.c-=dt;p.dc-=dt;
if(p.ds>0){p.ds-=dt;p.vx=p.dd*ph.dh;p.vy=0}else{const tgt=m*ph.spd;if(m){const dir=Math.sign(tgt-p.vx);p.vx+=dir*ph.acc*dt;if(dir>0&&p.vx>tgt||dir<0&&p.vx<tgt)p.vx=tgt}else{const f=Math.sign(p.vx),a=ph.fr*dt;p.vx=Math.abs(p.vx)<=a?0:p.vx-f*a}p.vy=Math.min(p.vy+ph.gr*dt,ph.mf)}
if(p.jb>0&&(p.g||p.c>0)){p.vy=-ph.j;p.g=false;p.c=0;p.jb=0}
const sols=plats.filter(t=>!t.c||!t.g);p.x+=p.vx*dt;for(const t of sols){if(!hit(p,t))continue;if(p.vx>0)p.x=t.x-p.w;else if(p.vx<0)p.x=t.x+t.w;p.vx=0}
p.y+=p.vy*dt;p.g=false;for(const t of sols){if(!hit(p,t))continue;if(p.vy>0){p.y=t.y-p.h;p.vy=0;p.g=true;p.c=ph.ct;if(t.c){t.t+=dt;if(t.t>.3){t.g=1;t.re=2.8}}}else if(p.vy<0){p.y=t.y+t.h;p.vy=0}}
if(!p.g)for(const t of plats)if(t.c)t.t=0;p.x=cl(p.x,0,W.w-p.w);for(const s of spikes)if(hit(p,s))return die();for(const s of saws){const tt=et*s.s+s.p,x=s.cx+(s.a==='x'?Math.sin(tt)*s.amp:0),y=s.cy+(s.a==='y'?Math.sin(tt)*s.amp:0);if(chr(x,y,s.r,p))return die()}for(const l of lasers){const a=((et+l.ph)%l.per)<l.on;if(a&&hit(p,l))return die()}if(p.y>W.h+120)return die();if(hit(p,B)){done=true;win.style.display='grid';res.textContent=`Смерти: ${deaths} | Время: ${((performance.now()-start)/1000).toFixed(2)}с`}}
function draw(et){const w=innerWidth,h=innerHeight;const g=cx.createLinearGradient(0,0,0,h);g.addColorStop(0,'#0a1623');g.addColorStop(.55,'#163049');g.addColorStop(1,'#2f4f67');cx.fillStyle=g;cx.fillRect(0,0,w,h);cx.save();cx.translate(-cam.x,-cam.y);
cx.fillStyle='#76d7ff';cx.fillRect(A.x-12,A.y-100,12,100);cx.fillStyle='#d9f5ff';cx.fillRect(A.x,A.y-92,42,24);cx.fillStyle='#0e141d';cx.font='700 22px Trebuchet MS';cx.fillText('A',A.x+12,A.y-74);
cx.fillStyle='#8dffab';cx.fillRect(B.x-12,B.y-100,12,100);cx.fillStyle='#ddffe7';cx.fillRect(B.x,B.y-92,52,28);cx.fillStyle='#102016';cx.fillText('B',B.x+16,B.y-70);
for(const t of plats){if(t.c&&t.g)continue;cx.fillStyle=t.c?'#d8be89':'#51606f';cx.fillRect(t.x,t.y,t.w,t.h);cx.fillStyle='rgba(255,255,255,.08)';cx.fillRect(t.x,t.y,t.w,4)}
for(const s of spikes){const n=Math.max(2,Math.floor(s.w/18)),sw=s.w/n;cx.fillStyle='#b0c4d4';for(let i=0;i<n;i++){const x=s.x+i*sw;cx.beginPath();cx.moveTo(x,s.y+s.h);cx.lineTo(x+sw*.5,s.y);cx.lineTo(x+sw,s.y+s.h);cx.closePath();cx.fill()}}
for(const l of lasers){const a=((et+l.ph)%l.per)<l.on;cx.fillStyle=a?'rgba(255,75,75,.86)':'rgba(255,75,75,.2)';cx.fillRect(l.x,l.y,l.w,l.h);if(a){cx.fillStyle='rgba(255,210,210,.9)';cx.fillRect(l.x+5,l.y,4,l.h)}}
for(const s of saws){const tt=et*s.s+s.p,x=s.cx+(s.a==='x'?Math.sin(tt)*s.amp:0),y=s.cy+(s.a==='y'?Math.sin(tt)*s.amp:0);cx.strokeStyle='rgba(220,235,255,.2)';cx.lineWidth=3;cx.beginPath();if(s.a==='x'){cx.moveTo(s.cx-s.amp,s.cy);cx.lineTo(s.cx+s.amp,s.cy)}else{cx.moveTo(s.cx,s.cy-s.amp);cx.lineTo(s.cx,s.cy+s.amp)}cx.stroke();cx.fillStyle='#d5e4ef';cx.beginPath();cx.arc(x,y,s.r,0,Math.PI*2);cx.fill();cx.strokeStyle='#4f5f6d';cx.lineWidth=4;cx.stroke()}
const gl=p.ds>0?14:0;cx.fillStyle=p.ds>0?'#b4ffef':'#9fd9ff';cx.fillRect(p.x,p.y,p.w,p.h);if(gl){cx.fillStyle='rgba(170,255,240,.35)';cx.fillRect(p.x-gl,p.y+8,p.w+gl*2,p.h-16)}cx.restore()}
let prv=performance.now();rs();fullReset();requestAnimationFrame(function loop(now){const dt=Math.min(.033,(now-prv)/1000);prv=now;const et=(now-start)/1000;if(!done){upd(dt,et);cam.x=cl(p.x-innerWidth*.34,0,W.w-innerWidth);cam.y=cl(p.y-innerHeight*.56,0,W.h-innerHeight)}draw(et);st.textContent=`Смерти: ${deaths} | Время: ${et.toFixed(1)}с`;requestAnimationFrame(loop)});
</script>
</body>
</html>